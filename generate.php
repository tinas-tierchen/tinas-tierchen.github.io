<?php

$pages = [
    [
        'file' => 'index.html',
        'template' => 'index',
        'items' => [
            [
                'src' => 'tiger.jpeg',
                'name' => 'Amigurumi Tierchen',
                'href' => 'tierchen.html',
            ],
            [
                'src' => 'maus_und_mystik.jpeg',
                'name' => 'Boardgame Zubehör',
                'href' => 'boardgame.html',
            ],
            [
                'src' => 'tentakel.jpeg',
                'name' => 'Kleine Nerd Ecke',
                'href' => 'nerds.html',
            ],
            [
                'src' => 'kakteen.jpeg',
                'name' => 'Pflanzen',
                'href' => 'pflanzen.html',
            ],
            [
                'src' => 'klamotten/haarbaender.jpeg',
                'name' => 'Klamotten',
                'href' => 'klamotten.html',
            ],
        ],
    ],
    [
        'file' => 'tierchen.html',
        'template' => 'category',
        'title' => 'Amigurumi Tierchen',
        'description' => 'Vor einigen Jahren bin ich durch Zufall auf die Anleitung eines süßen kleinen Tierchens gestoßen. Seitdem haben mich diese Tierchen nicht mehr losgelassen, denn wer könnte so kleinen süßen Knopfaugen widerstehen. Im Laufe der Jahre habe ich so einige Tierchen gehäkelt und die Freude daran möchte ich gerne mit euch teilen.',
        'items' => [
            [
                'src' => [
                    'tiger.jpeg',
                    'tiger2.jpeg',
                ],
                'name' => 'Roary der Tiger',
                'description' => 'Jedes Tier im Dschungel kennt den kleinen, frechen Tiger Roary. Verschmitzt und gewitzt, wie er ist, hat er häufig nur Dummheiten im Kopf. Aber lange kann ihm keiner böse sein. Denn in diesem Tigerchen steckt natürlich auch ein bisschen Miezekatze.',
            ],
            [
                'src' => [
                    'elch.jpeg',
                    'elch2.jpeg',
                    'elch3.jpeg',
                ],
                'name' => 'Morton der Elch',
                'description' => 'Der Elch Morton erregt mit seinem prächtigen Geweih überall Aufmerksamkeit. Und das genießt er sichtlich. Morton kommt aus dem hohen Norden und ist Kälte und Schnee gewöhnt. Aber ganz ehrlich … nichts geht ihm über ein Nickerchen vor dem offenen Kamin.',
            ],
            [
                'src' => [
                    'hase.jpeg',
                    'hase2.jpeg',
                    'hase3.jpeg',
                ],
                'name' => 'Wasabi das Häschen',
                'description' => 'Verspielt, eigensinnig und fröhlich, so ist das Häschen Wasabi. Es findet nichts lustiger, als mit seinen Freunden um die Wette zu rennen, denn im Hakenschlagen und Über-Hindernisse-Springens ist es unschlagbar. Und wer so schnell laufen kann, der ist auch gut im Streiche spielen…',
            ],
            [
                'src' => [
                    'tukan.jpeg',
                    'tukan2.jpeg',
                    'tukan3.jpeg',
                ],
                'name' => 'Zico der Tukan',
                'description' => 'Sieht der Tukan Zico mit seinem glänzend schwarzen Federkleid und dem leuchtend gelben Schnabel nicht richtig majestätisch aus? Als König der Paradiesvögel spreizt er jeden Tag seine Flügel und macht einen ausgedehnten Spazierflug durch den Regenwald.',
            ],
            [
                'src' => [
                    'welpe.jpeg',
                    'welpe2.jpeg',
                    'welpe3.jpeg',
                    'welpe4.jpeg',
                    'welpe5.jpeg',
                    'welpe6.jpeg',
                ],
                'name' => 'Dakota der Welpe',
                'description' => 'Dakota ist lieb, knuffig und passt genau auf die Handfläche, so dass er dich überall hin begleiten kann. Dakota ist ein verspielter Welpe, neugierig und voller Energie. Seine langen Ohren flattern im Wind, wenn er auf seinen winzigen Pfötchen angelaufen kommt.',
            ],
            [
                'src' => 'maus.jpg',
                'name' => 'Manfred die Maus',
                'description' => 'Manfred ist vielleicht klein, hat aber immer Lust auf große Abenteuer. Er hat eine blühende Fantasie, doch solange er nicht nachdenkt, bevor er loslegt, bringt er sich immer wieder in unmögliche Situationen.',
            ],
            [
                'src' => [
                    'papagei.jpeg',
                    'papagei2.jpeg',
                    'papagei3.jpeg',
                    'papagei4.jpeg',
                    'papagei5.jpeg',
                    'papagei6.jpeg',
                    'papagei7.jpeg',
                ],
                'name' => 'Pepe der Papagei',
                'description' => 'In seinem prächtigen bunten Federkleid, liebt es Pepe ganz entspannt auf dem Baum zu sitzen und die anderen Tiere zu betrachten und ihre Wörter zu lernen.',
            ],
            [
                'src' => [
                    'lemur.jpeg',
                    'lemur2.jpeg',
                    'lemur3.jpeg',
                ],
                'name' => 'Sartu der Lemur',
                'description' => 'Wenn dich der kleine Sartu mit seinen großen Augen ansieht und lächelt, ist es um dich geschehen. Den charmanten Lemuren muss man einfach mögen. Wegen seines prächtigen Schwanzes beneiden ihn die anderen Tiere aber ziemlich oft.',
            ],
        ],
    ],
    [
        'file' => 'boardgame.html',
        'template' => 'category',
        'title' => 'Boardgame Zubehör',
        'description' => 'Auch Brettspiele und Häkeln lassen sich bestens kombinieren.',
        'items' => [
            [
                'src' => 'maus_und_mystik.jpeg',
                'name' => 'Maus & Mystik Täschchen',
                'description' => 'Alles praktisch verpackt und beschriftet. So geht nichts mehr verloren.',
            ],
            [
                'src' => [
                    'wuerfelbeutel.jpeg',
                    'wuerfelbeutel2.jpeg',
                ],
                'name' => 'Würfeluntersetzer',
                'description' => 'Praktisches Gimmick für alle Würfelspiele. Lässt sich auf- und zukletten an den Ecken',
            ],
            [
                'src' => [
                    'stoffies.jpeg',
                    'stoffies2.jpeg',
                ],
                'name' => 'Stampfi und Pinky',
                'description' => 'Zwei Figuren aus den Stoffi-Chroniken.',
            ],
        ],
    ],
    [
        'file' => 'nerds.html',
        'template' => 'category',
        'title' => 'Kleine Nerd Ecke',
        'items' => [
            [
                'src' => 'yoshi.jpeg',
                'name' => 'Yoshi mit Ei',
            ],
            [
                'src' => [
                    'pilze.jpeg',
                    'pilze2.jpeg',
                    'pilze3.jpeg',
                ],
                'name' => 'PowerUp und LevelUp Pilze',
            ],
            [
                'src' => [
                    'stern.jpeg',
                    'stern2.jpeg',
                    'stern3.jpeg',
                ],
                'name' => 'Stern',
            ],
            [
                'src' => 'tentakel.jpeg',
                'name' => 'Purpur & Grün Tentakel',
            ],
        ],
    ],
    [
        'file' => 'pflanzen.html',
        'template' => 'category',
        'title' => 'Pflanzen',
        'description' => 'Das Praktische an gehäkelten Pflanzen: Man muss sie nicht giesen und sie blühen immer.',
        'items' => [
            [
                'src' => [
                    'kakteen.jpeg',
                    'kakteen2.jpeg',
                ],
                'name' => 'Kakteen',
                'description' => 'Diese niedlichen Kakteen habe ich als Gastgeschenke für meine Hochzeit gehäkelt.',
            ],
            [
                'src' => [
                    'blume.jpeg',
                    'blume2.jpeg',
                ],
                'name' => 'Blume',
                'description' => 'Auch ohne Wasser blüht sie immer.',
            ],
        ],
    ],
    [
        'file' => 'klamotten.html',
        'template' => 'category',
        'title' => 'Klamotten',
        'description' => 'Im Laufe der Jahre haben sich so einige Klamotten angesammelt. Ist ja auch kein Wunder, bei so vielen verschiedenen Möglichkeiten. Ich hatte mir eigentlich vorgenommen keine mehr zu Häkeln, da mein Kleiderschrank bereits randvoll ist, aber wenn ich ein cooles Teil sehe kann ich irgendwie nicht anders.',
        'items' => [
            [
                'src' => 'klamotten/haarbaender.jpeg',
                'name' => 'Haarbänder',
            ],
            [
                'src' => 'klamotten/haarband_grau.jpeg',
                'name' => 'Graues Haarband',
            ],
            [
                'src' => 'klamotten/asynchron_gehaekelt.jpg',
                'name' => 'Asynchron gehäkelt',
            ],
            [
                'src' => 'klamotten/bereit_fuer_den_herbst.jpg',
                'name' => 'Bereit für den Herbst',
            ],
            [
                'src' => 'klamotten/ein_hauch_von_masche.jpg',
                'name' => 'Ein Hauch von Masche',
            ],
            [
                'src' => 'klamotten/einfaches_strick_top.jpg',
                'name' => 'Einfaches Strick-Top',
            ],
            [
                'src' => 'klamotten/einfaches_top_mit_lochmuster.jpg',
                'name' => 'Einfaches Top mit Lochmuster',
            ],
            [
                'src' => 'klamotten/ganz_schoen_schraeg.jpg',
                'name' => 'Ganz schön Schräg',
            ],
            [
                'src' => 'klamotten/grauer_kurzarmpulli_mit_lochmusterleiste.jpg',
                'name' => 'Grauer Kurzarmpulli mit Lochmusterleiste',
            ],
            [
                'src' => 'klamotten/mode_zum_quadrat.jpg',
                'name' => 'Mode zum Quadrat',
            ],
            [
                'src' => 'klamotten/perfekt_fuer_kuehle_herbsttage.jpg',
                'name' => 'Perfekt für kühle Herbsttage',
            ],
            [
                'src' => 'klamotten/pulli_mit_trompetenaermeln.jpg',
                'name' => 'Pulli mit Trompetenärmeln',
            ],
            [
                'src' => 'klamotten/pullover_in_lila_toenen.jpg',
                'name' => 'Pullover in lila Tönen',
            ],
            [
                'src' => 'klamotten/retro_look.jpg',
                'name' => 'Retro Look',
            ],
            [
                'src' => 'klamotten/schlichte_eleganz.jpg',
                'name' => 'Schlichte Eleganz',
            ],
            [
                'src' => 'klamotten/schwarz_ist_nie_out.jpg',
                'name' => 'Schwarz ist nie out',
            ],
            [
                'src' => 'klamotten/schwarz_weiss_mix.jpg',
                'name' => 'Schwarz-Weiß-Mix',
            ],
            [
                'src' => 'klamotten/schwarzer_pulli_fuer_kalte_tage.jpg',
                'name' => 'Schwarzer Pulli für kalte Tage',
            ],
            [
                'src' => 'klamotten/sommerliches_oberteil.jpg',
                'name' => 'Sommerliches Oberteil',
            ],
            [
                'src' => 'klamotten/traum_in_tuerkis.jpg',
                'name' => 'Traum in Türkis',
            ],
            [
                'src' => 'klamotten/upcycling.jpg',
                'name' => 'Upcycling',
            ],
            [
                'src' => 'klamotten/weisses_sommeroberteil.jpg',
                'name' => 'Weißes Sommeroberteil',
            ],
            [
                'src' => 'klamotten/zu_streifen_greifen.jpg',
                'name' => 'Zu Streifen greifen',
            ],
            [
                'src' => 'klamotten/schneller_ueberwurf.jpg',
                'name' => 'Schneller Überwurf',
            ],
            [
                'src' => 'klamotten/stola_aus_sockenwolle.jpg',
                'name' => 'Stola aus Sockenwolle',
            ],
            [
                'src' => 'klamotten/fruehlings_weste.jpg',
                'name' => 'Frühlings-Weste',
            ],
        ],
    ],
];

function generateThumbnail(string $path, string $targetPath, int $targetWidth): void
{
    if (file_exists($targetPath)) {
        return;
    }

    echo 'Generating thumbnail for ' . $path . "\n";

    $image = imagecreatefromjpeg($path);
    $width = imagesx($image);
    $height = imagesy($image);

    $targetHeight = floor($height * ($targetWidth / $width));

    $thumb = imagecreatetruecolor($targetWidth, $targetHeight);
    imagecopyresampled($thumb, $image, 0, 0, 0, 0, $targetWidth, $targetHeight, $width, $height);

    imagejpeg($thumb, $targetPath);
}

function generateThumbnailsForPath(string $path, int $targetWidth): void
{
    $targetPath = 'img_' . $targetWidth . substr($path, 3);
    if (!file_exists($targetPath)) {
        mkdir($targetPath);
    }

    $images = scandir($path);
    foreach ($images as $image) {
        if ('.' === substr($image, 0, 1)) {
            continue;
        }


        if (is_dir($path . '/' . $image)) {
            generateThumbnailsForPath($path . '/' . $image, $targetWidth);
            continue;
        }

        generateThumbnail($path . '/' . $image, $targetPath . '/' . $image, $targetWidth);
    }
}
generateThumbnailsForPath('img', 256);


foreach ($pages as $page) {
    echo 'Generating ' . $page['file'] . "\n";

    $title = $page['title'] ?? '';
    $description = $page['description'] ?? '';
    $items = $page['items'] ?? [];

    ob_start();
    require 'templates/' . $page['template'] . '.php';
    $content = ob_get_clean();

    unset($title);
    unset($description);
    unset($items);


    ob_start();
    require 'templates/skeleton.php';
    file_put_contents($page['file'], ob_get_clean());
}
