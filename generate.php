<?php

$pages = [
    [
        'file' => 'index.html',
        'template' => 'index',
        'items' => [
            [
                'src' => 'tiger.jpeg',
                'name' => 'Amigurumi Tierchen',
                'href' => 'tierchen.html',
            ],
            [
                'src' => 'maus_und_mystik.jpeg',
                'name' => 'Boardgame Zubehör',
                'href' => 'boardgame.html',
            ],
            [
                'src' => 'tentakel.jpeg',
                'name' => 'Kleine Nerd Ecke',
                'href' => 'nerds.html',
            ],
            [
                'src' => 'kakteen.jpeg',
                'name' => 'Pflanzen',
                'href' => 'pflanzen.html',
            ],
            [
                'src' => 'klamotten/haarbaender.jpeg',
                'name' => 'Klamotten',
                'href' => 'klamotten.html',
            ],
        ],
    ],
    [
        'file' => 'tierchen.html',
        'template' => 'category',
        'title' => 'Amigurumi Tierchen',
        'description' => 'Vor einigen Jahren bin ich durch Zufall auf die Anleitung eines süßen kleinen Tierchens gestoßen. Seitdem haben mich diese Tierchen nicht mehr losgelassen, denn wer könnte so kleinen süßen Knopfaugen widerstehen. Im Laufe der Jahre habe ich so einige Tierchen gehäkelt und die Freude daran möchte ich gerne mit euch teilen.',
        'items' => [
            [
                'src' => 'tiger.jpeg',
                'name' => 'Roary der Tiger',
                'description' => 'Jedes Tier im Dschungel kennt den kleinen, frechen Tiger Roary. Verschmitzt und gewitzt, wie er ist, hat er häufig nur Dummheiten im Kopf. Aber lange kann ihm keiner böse sein. Denn in diesem Tigerchen steckt natürlich auch ein bisschen Miezekatze.',
            ],
            [
                'src' => 'elch.jpeg',
                'name' => 'Morton der Elch',
                'description' => 'Der Elch Morton erregt mit seinem prächtigen Geweih überall Aufmerksamkeit. Und das genießt er sichtlich. Morton kommt aus dem hohen Norden und ist Kälte und Schnee gewöhnt. Aber ganz ehrlich … nichts geht ihm über ein Nickerchen vor dem offenen Kamin.',
            ],
            [
                'src' => 'hase.jpeg',
                'name' => 'Wasabi das Häschen',
                'description' => 'Verspielt, eigensinnig und fröhlich, so ist das Häschen Wasabi. Es findet nichts lustiger, als mit seinen Freunden um die Wette zu rennen, denn im Hakenschlagen und Über-Hindernisse-Springens ist es unschlagbar. Und wer so schnell laufen kann, der ist auch gut im Streiche spielen…',
            ],
            [
                'src' => 'tukan.jpeg',
                'name' => 'Zico der Tukan',
                'description' => 'Sieht der Tukan Zico mit seinem glänzend schwarzen Federkleid und dem leuchtend gelben Schnabel nicht richtig majestätisch aus? Als König der Paradiesvögel spreizt er jeden Tag seine Flügel und macht einen ausgedehnten Spazierflug durch den Regenwald.',
            ],
            [
                'src' => 'welpe6.jpeg',
                'name' => 'Dakota der Welpe',
                'description' => 'Dakota ist lieb, knuffig und passt genau auf die Handfläche, so dass er dich überall hin begleiten kann. Dakota ist ein verspielter Welpe, neugierig und voller Energie. Seine langen Ohren flattern im Wind, wenn er auf seinen winzigen Pfötchen angelaufen kommt.',
            ],
            [
                'src' => 'maus.jpg',
                'name' => 'Manfred die Maus',
                'description' => 'Manfred ist vielleicht klein, hat aber immer Lust auf große Abenteuer. Er hat eine blühende Fantasie, doch solange er nicht nachdenkt, bevor er loslegt, bringt er sich immer wieder in unmögliche Situationen.',
            ],
            [
                'src' => 'papagei7.jpeg',
                'name' => 'Pepe der Papagei',
                'description' => '…',
            ],
            [
                'src' => 'lemur.jpeg',
                'name' => 'Sartu Lemur',
                'description' => 'Wenn dich der kleine Sartu mit seinen großen Augen ansieht und lächelt, ist es um dich geschehen. Den charmanten Lemuren muss man einfach mögen. Wegen seines prächtigen Schwanzes beneiden ihn die anderen Tiere aber ziemlich oft.',
            ],
        ],
    ],
    [
        'file' => 'boardgame.html',
        'template' => 'category',
        'title' => 'Boardgame Zubehör',
        'description' => '…',
        'items' => [
            [
                'src' => 'maus_und_mystik.jpeg',
                'name' => 'Maus & Mystik Täschchen',
                'description' => '…',
            ],
            [
                'src' => 'wuerfelbeutel.jpeg',
                'name' => 'Würfeluntersetzer',
                'description' => '…',
            ],
            [
                'src' => 'stoffies.jpeg',
                'name' => 'Stoffies',
                'description' => '…',
            ],
        ],
    ],
    [
        'file' => 'nerds.html',
        'template' => 'category',
        'title' => 'Kleine Nerd Ecke',
        'description' => '…',
        'items' => [
            [
                'src' => 'yoshi.jpeg',
                'name' => 'Yoshi mit Ei',
                'description' => '…',
            ],
            [
                'src' => 'pilze.jpeg',
                'name' => 'PowerUp und LevelUp Pilze',
                'description' => '…',
            ],
            [
                'src' => 'stern.jpeg',
                'name' => 'Stern',
                'description' => '…',
            ],
            [
                'src' => 'tentakel.jpeg',
                'name' => 'Purpur & Grün Tentakel',
                'description' => '…',
            ],
        ],
    ],
    [
        'file' => 'pflanzen.html',
        'template' => 'category',
        'title' => 'Pflanzen',
        'description' => '…',
        'items' => [
            [
                'src' => 'kakteen.jpeg',
                'name' => 'Kakteen',
                'description' => '…',
            ],
            [
                'src' => 'blume.jpeg',
                'name' => 'Blume',
                'description' => '…',
            ],
        ],
    ],
    [
        'file' => 'klamotten.html',
        'template' => 'category',
        'title' => 'Klamotten',
        'description' => '…',
        'items' => [
            [
                'src' => 'klamotten/haarbaender.jpeg',
                'name' => 'Haarbänder',
            ],
            [
                'src' => 'klamotten/haarband_grau.jpeg',
                'name' => 'Graues Haarband',
            ],
            [
                'src' => 'klamotten/asynchron_gehaekelt.jpg',
                'name' => 'Asynchron gehäkelt',
            ],
            [
                'src' => 'klamotten/bereit_fuer_den_herbst.jpg',
                'name' => 'Bereit für den Herbst',
            ],
            [
                'src' => 'klamotten/ein_hauch_von_masche.jpg',
                'name' => 'Ein Hauch von Masche',
            ],
            [
                'src' => 'klamotten/einfaches_strick_top.jpg',
                'name' => 'Einfaches Strick-Top',
            ],
            [
                'src' => 'klamotten/einfaches_top_mit_lochmuster.jpg',
                'name' => 'Einfaches Top mit Lochmuster',
            ],
            [
                'src' => 'klamotten/ganz_schoen_schraeg.jpg',
                'name' => 'Ganz schön Schräg',
            ],
            [
                'src' => 'klamotten/grauer_kurzarmpulli_mit_lochmusterleiste.jpg',
                'name' => 'Grauer Kurzarmpulli mit Lochmusterleiste',
            ],
            [
                'src' => 'klamotten/mode_zum_quadrat.jpg',
                'name' => 'Mode zum Quadrat',
            ],
            [
                'src' => 'klamotten/perfekt_fuer_kuehle_herbsttage.jpg',
                'name' => 'Perfekt für kühle Herbsttage',
            ],
            [
                'src' => 'klamotten/pulli_mit_trompetenaermeln.jpg',
                'name' => 'Pulli mit Trompetenärmeln',
            ],
            [
                'src' => 'klamotten/pullover_in_lila_toenen.jpg',
                'name' => 'Pullover in lila Tönen',
            ],
            [
                'src' => 'klamotten/retro_look.jpg',
                'name' => 'Retro Look',
            ],
            [
                'src' => 'klamotten/schlichte_eleganz.jpg',
                'name' => 'Schlichte Eleganz',
            ],
            [
                'src' => 'klamotten/schwarz_ist_nie_out.jpg',
                'name' => 'Schwarz ist nie out',
            ],
            [
                'src' => 'klamotten/schwarz_weiss_mix.jpg',
                'name' => 'Schwarz-Weiß-Mix',
            ],
            [
                'src' => 'klamotten/schwarzer_pulli_fuer_kalte_tage.jpg',
                'name' => 'Schwarzer Pulli für kalte Tage',
            ],
            [
                'src' => 'klamotten/sommerliches_oberteil.jpg',
                'name' => 'Sommerliches Oberteil',
            ],
            [
                'src' => 'klamotten/traum_in_tuerkis.jpg',
                'name' => 'Traum in Türkis',
            ],
            [
                'src' => 'klamotten/upcycling.jpg',
                'name' => 'Upcycling',
            ],
            [
                'src' => 'klamotten/weisses_sommeroberteil.jpg',
                'name' => 'Weißes Sommeroberteil',
            ],
            [
                'src' => 'klamotten/zu_streifen_greifen.jpg',
                'name' => 'Zu Streifen greifen',
            ],
        ],
    ],
];

function generateThumbnail(string $path, string $targetPath, int $targetWidth): void
{
    if (file_exists($targetPath)) {
        return;
    }

    echo 'Generating thumbnail for ' . $path . "\n";

    $image = imagecreatefromjpeg($path);
    $width = imagesx($image);
    $height = imagesy($image);

    $targetHeight = floor($height * ($targetWidth / $width));

    $thumb = imagecreatetruecolor($targetWidth, $targetHeight);
    imagecopyresampled($thumb, $image, 0, 0, 0, 0, $targetWidth, $targetHeight, $width, $height);

    imagejpeg($thumb, $targetPath);
}

function generateThumbnailsForPath(string $path, int $targetWidth): void
{
    $targetPath = 'img_' . $targetWidth . substr($path, 3);
    if (!file_exists($targetPath)) {
        mkdir($targetPath);
    }

    $images = scandir($path);
    foreach ($images as $image) {
        if ('.' === substr($image, 0, 1)) {
            continue;
        }


        if (is_dir($path . '/' . $image)) {
            generateThumbnailsForPath($path . '/' . $image, $targetWidth);
            continue;
        }

        generateThumbnail($path . '/' . $image, $targetPath . '/' . $image, $targetWidth);
    }
}
generateThumbnailsForPath('img', 256);


foreach ($pages as $page) {
    echo 'Generating ' . $page['file'] . "\n";

    $title = $page['title'] ?? '';
    $description = $page['description'] ?? '';
    $items = $page['items'] ?? [];

    ob_start();
    require 'templates/' . $page['template'] . '.php';
    $content = ob_get_clean();

    unset($title);
    unset($description);
    unset($items);


    ob_start();
    require 'templates/skeleton.php';
    file_put_contents($page['file'], ob_get_clean());
}
